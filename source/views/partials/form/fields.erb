<%
formData = form_data
isNetlifyForm = formData[:TYPE] == "form"
isPaymentForm = formData[:TYPE] == "product"
%>

<!--**********************************************
    =Netlify form
***********************************************-->

<% if isNetlifyForm %>
  <label aria-hidden="true" class="e-hidden">
    <span>Don't fill this out!</span>
    <input name="bot-field" />
  </label>

  <% formData[:elements].each do |elem|
    labelNameCap = elem[:label].capitalize.gsub("-", " ")
    isNotInput = ["textarea"].include?(elem[:input_type])

    fieldTag = isNotInput ? "textarea" : "input"

    fieldAttrs = {
      "class": "form__field",
      "type": (elem[:input_type] if !isNotInput),
      "name": elem[:label],
      "placeholder": labelNameCap + "â€¦"
    }.compact

    fieldAttrs.merge!(required: "") if elem[:required] %>

    <label class="form__label">
      <span class="e-hidden"><%= labelNameCap + ": " %></span>
      <%= tag(fieldTag, fieldAttrs) %>
      <span class="form__err">Please review this field</span>
    </label>

<!--**********************************************
    =Payment form (Braintree)
***********************************************-->

<% end; elsif isPaymentForm
  paymentForm = formData[:payment_form]
  isBasic = paymentForm == "basic"
  isShipping = paymentForm == "shipping",
  formPages = [{
    title: "Start your order",
    fields: [
      "first-name",
      "surname",
      "email-address"
    ]}, {
    title: "Shipping information",
    fields: [
      "address-line-1",
      "address-line-2",
      "address-line-3",
      "postcode",
      "country"
      ]}, {
    title: "Payment information",
    fields: [
      "card-number",
      "expiration-date",
      "cvv"
  ]}]
%>

  <div id="form-pages" class="form__pages">

    <% formPages.each_with_index do |page, index| %>

      <!--	=Page	-->
      <div id="form-pg-<%= index %>" class="<%= index > 0 ? "JS-inactive" : "JS-active" %> form__pg">

        <!--	=Title	-->
        <h3 class="title-md e-col-brand-green-1 e-mgn-b-sm"><%= page[:title] %></h3>

        <!--	=Fields	-->
        <% page[:fields].each do |field| %>
          <label class="form__label form__label--bt label-xs" for="<%= field %>">
            <%= field.capitalize.gsub("-", " ") %>
          </label>
          <div class="form__field form__field--bt" id="<%= field %>"></div>
        <% end %>

        <!--	=Form actions	-->
        <div class="form__actions">

          <% if index > 0 %>
            <div class="form__prev">
              <%= partial "views/partials/btn",
                locals: { local_data: {
                  type: "state",
                  switch: true,
                  size: "sm",
                  style: "secondary",
                  label_on: "Back",
                  label_size: "sm",
                  aria_id: "activate-form-pg-#{ index }",
                  aria_target_id: "form-pg-#{ index }" }} %>
            </div>
          <% end %>

          <% if index < 2 %>
            <div class="form__next">
              <%= partial "views/partials/btn",
                locals: { local_data: {
                  type: "state",
                  switch: true,
                  size: "sm",
                  style: "primary",
                  label_on: "Next",
                  label_size: "sm",
                  aria_id: "activate-form-pg-#{ index + 1 }",
                  aria_target_id: "form-pg-#{ index + 1 }" }} %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
