<%
require "json"
panelData = local_data[:entry_data]
index = local_data[:index]

title = panelData[:title]
caption = panelData[:caption]

rowsWidth = ""
if panelData[:rows_width] == "narrow"
  rowsWidth = "medium"
elsif panelData[:rows_width] == "medium"
  rowsWidth = "wide"
else
  rowsWidth = "full"
end

rowOneGridCellWidth = 12 / panelData[:charts_row_1].length
if panelData[:charts_row_2]
  rowTwoGridCellWidth = 12 / panelData[:charts_row_2].length
end
%>

<section
  id="panel-<%= index %>"
  class="panel e-bgc-white-1">

  <% if panelData[:show_title] %>
    <header class="panel__content panel__content--full">
      <div class="grid grid--sm grid--center">
        <div class="grid__cell grid__cell--sm-12 grid__cell--sm-above-sm-7">
          <h2 class="title-lg e-col-brand-green-2 e-mgn-b-md"><%= panelData[:title] %></h2>
        </div>
      </div>
    </header>
  <% end %>

  <div class="panel__content panel__content--<%= rowsWidth %>">
    <div class="grid grid--md">

      <!--**********************************************
          =Row 1
      ***********************************************-->

      <% panelData[:charts_row_1].each_with_index do |panelEntry, index| %>
        <div class="grid__cell grid__cell--md-12 grid__cell--md-above-sm-<%= rowOneGridCellWidth %>">
          <% if panelEntry[:TYPE] == "chart" %>
            <section class="chart">
              <% if panelEntry[:show_header] %>
                <header class="chart__header">
                  <% if panelData[:show_title] %>
                    <h3 class="title-xs e-col-brand-green-2"><%= panelEntry[:title] %></h3>
                  <% else %>
                    <h2 class="title-xs e-col-brand-green-2"><%= panelEntry[:title] %></h2>
                  <% end %>
                  <% if panelData[:caption] %>
                    <p class="e-fz-xs e-col-grey-3"><%= panelEntry[:caption] %></p>
                  <% end %>
                </header>
              <% end %>
              <div
                class="chart__container"
                style="width: 100%;
                  <%= "height: #{ panelEntry[:chart_height] }px;" if panelEntry[:chart_height] %>">
                <canvas class="chart__canvas"></canvas>
              </div>
              <script class="chart__config" type="application/json">
                {
                  "type": "<%= panelEntry[:chart_type] %>",
                  "data": {
                    "datasets": <%= panelEntry[:chart_datasets] %>,
                    "labels": <%= panelEntry[:chart_labels] %>
                  },
                  "options": <%= panelEntry[:chart_options] %>,
                  "customConfig": <%= panelEntry[:chart_custom_config] %>
                }
              </script>
            </section>
          <% end %>
        </div>
      <% end %>

      <!--**********************************************
          =Row 2
      ***********************************************-->

      <% if panelData[:charts_row_2] %>
        <% panelData[:charts_row_2].each_with_index do |panelEntry, index| %>

          <%# Chart %>
          <% if panelEntry[:TYPE] == "chart" %>
            <div class="grid__cell grid__cell--md-12 grid__cell--md-above-sm-<%= rowTwoGridCellWidth %>">
              <section class="chart">
                <% if panelEntry[:show_header] %>
                  <header class="chart__header">
                    <% if panelData[:show_title] %>
                      <h3 class="title-sm e-col-brand-green-2 e-mgn-b-xxs"><%= panelEntry[:title] %></h3>
                    <% else %>
                      <h2 class="title-sm e-col-brand-green-2 e-mgn-b-xxs"><%= panelEntry[:title] %></h2>
                    <% end %>
                    <p class="e-fz-xs e-col-grey-3"><%= panelEntry[:caption] %></p>
                  </header>
                <% end %>
                <div
                  class="chart__container"
                  style="width: 100%;
                    <%= "height: #{ panelEntry[:chart_height] }px;" if panelEntry[:chart_height] %>">
                  <canvas class="chart__canvas"></canvas>
                </div>
                <script class="chart__config" type="application/json">
                  {
                    "type": "<%= panelEntry[:chart_type] %>",
                    "data": {
                      "datasets": <%= panelEntry[:chart_datasets] %>,
                      "labels": <%= panelEntry[:chart_labels] %>
                    },
                    "options": <%= panelEntry[:chart_options] %>,
                    "customConfig": <%= panelEntry[:chart_custom_config] %>
                  }
                </script>
              </section>
            </div>

          <%# Text box %>
          <% elsif panelEntry[:TYPE] == "text_box" %>
            <div class="grid__cell grid__cell--md-12 grid__cell--md-above-sm-<%= rowTwoGridCellWidth %>">
              <div class="text-box">
                <% if panelEntry[:show_title] %>
                  <% if panelData[:show_title] %>
                    <h3 class="title-md e-col-brand-green-2 e-mgn-b-xxs"><%= panelEntry[:title] %></h3>
                  <% else %>
                    <h2 class="title-lg e-col-brand-green-2 e-mgn-b-xxs"><%= panelEntry[:title] %></h2>
                  <% end %>
                <% end %>
                <div class="copy">
                  <%= markdown(panelEntry[:copy]) %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</section>

<section class="chart">
<div
  class="chart__container"
  style="width: 100%; height; width: 500px;">
  <canvas class="chart__canvas"></canvas>
</div>
<script class="chart__config" type="application/json">

{
  "type": "polarArea",
  "data": {
    "datasets": [{
      "data": [28, 5, 27, 2, 5],
      "backgroundColor": [
        "blue", "green",
        "yellow", "purple",
        "grey"
      ]
    }],
    "labels": [
      "ESIC: SIs considered", "ESIC: SIs recommended",
      "SLSC: SIs considered", "SLSC: SIs recommended",
      "Total propsed negative"
    ]
  },
  "options": {
    "aspectRatio": 1
  },
  "customConfig": {

  }
}


</script>
</section>
