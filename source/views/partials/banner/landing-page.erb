<%
entryData = local_data[:entry_data]
accent = "e-acc-#{ catColor(entryData[:category]) }-2-bottom" if entryData[:category]
safeTitle = CGI.escape(entryData[:title])
isThemePage = @entry[:TYPE] == "theme_page"
%>

<header class="banner JS-banner--full <%= accent if !entryData[:show_introduction] %>">
  <%= partial "views/partials/banner/image",
    locals: { local_data: {
      entry_data: entryData }} %>

  <div class="banner__inner banner__inner--lp">
    <div class="banner__content banner__content--lp">

      <% if !entryData[:index_page] %>
        <% if isThemePage %>
          <span class="label-xxs label-tag e-acc-brand-green-2 e-col-white-1">Theme</span>
        <% else %>
          <span class="label-xxs label-tag e-acc-<%= catColor(entryData[:category]) %>-2 e-col-white-1">
            <%= entryData[:meta_label] %>
          </span>
        <% end %>
      <% end %>

      <h1
        class="banner__title title-<%= @entry[:category] == "blog" ? "xl" : "xxl" %> JS-truncate e-mgn-t-xs"
        data-truncate="{ 'xs': 120 }"><%= entryData[:title] %></h1>

      <% if entryData[:subtitle] %>
        <p class="banner__strap e-mgn-t-xs"><%= entryData[:subtitle] %></p>
      <% end %>

      <% if entryData[:calls_to_action] != nil %>
        <div class="grid grid--xs grid--above-sm-center e-mgn-t-sm print__hide">
          <% entryData[:calls_to_action].each do |cta| %>
            <div class="grid__cell">

              <% if ["cta_download", "cta_page"].include?(cta[:TYPE])  %>
                <% url = cta[:TYPE] == "cta_download" ? cta[:file][:url] : "#{siteData(:site_url)}/#{cta[:page_slug]}" %>
                <%= partial "views/partials/btn",
                  locals: { local_data: {
                    type: "link", size: "md", style: "primary",
                    label: cta.button_text, label_size: "md",
                    url: url }} %>

              <% end; if cta[:TYPE] == "cta_modal"
                modalID = cta[:modal][:cta_id]
                modalContent = cta[:modal][:content]
                btnText = cta[:button_text] %>

                <%= partial "views/partials/btn",
                  locals: { local_data: {
                    type: "state",
                    size: "md", style: "primary",
                    label_on: "Close", label_off: btnText,
                    label_size: "md",
                    page: "no-scroll", switch: true,
                    aria_id: "activate-#{ modalID }",
                    aria_target_id: modalID }} %>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
      <% if @entry[:share_buttons] %>
        <div class="banner__social grid grid--xxs e-pad-t-sm print__hide">
          <%= partial "views/partials/social",
            locals: { local_data: {
              icons: [
                "https://twitter.com/intent/tweet?text=#{ safeTitle }&url=#{ siteData(:site_url) }/#{ entryData[:slug] }&via=HansardSociety&related=HansardSociety",
                "https://facebook.com/sharer.php?u=#{ siteData(:site_url) }/#{ entryData[:slug] }",
                "https://www.linkedin.com/shareArticle?mini=true&url=#{ siteData(:site_url) }/#{ entryData[:slug] }&title=#{ safeTitle }&source=hansardsociety.org.uk"
              ]}} %>
        </div>
      <% end %>
    </div>
  </div>

  <% if entryData[:calls_to_action] != nil
    entryData[:calls_to_action].each do |cta|
      if cta[:TYPE] == "cta_modal"
        modalID = cta[:modal][:cta_id]
        modalContent = cta[:modal][:content]
        modalForm = cta[:modal][:form]
        modalWidth = modalForm ? "narrow" : false %>

        <%= partial "views/partials/modal",
          locals: { local_data: {
            id: modalID,
            content: modalContent,
            form: (modalForm ? modalForm : false),
            size: modalWidth }} %>
  <% end; end; end %>
</header>
