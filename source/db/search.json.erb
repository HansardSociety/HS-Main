<%
childPages = data.hs.child_page
landingPages = data.hs.landing_page
allPages = childPages.merge(landingPages).reject{|id, page| page.noindex}

db = allPages.map do |id, page|
  {
    "objectID": page.ID,
    "title": markdownStrip(page.title),
    "slug": page.slug,
    "category": page.category.gsub("-", " "),
    "sub_category": (page.sub_category.gsub("-", " ") if page.sub_category),
    "theme": page.theme.map{|theme| theme.gsub("-", " ")},
    "sub_theme": (page.sub_theme.map{|theme| theme.gsub("-", " ")} if page.sub_theme),
    "sub_theme_orig": (page.sub_theme_orig.map{|theme| theme.downcase} if page.sub_theme_orig),
    "description": markdownStrip(page.introduction),
    "date": page.date_time.integer,
    "meta_label": (page.meta_label if page.meta_label),
    "image": page.banner_image.url
  }
end

dbDescending = db.sort_by{ |page| - page[:date] }
%>

<%= dbDescending.to_json %>
